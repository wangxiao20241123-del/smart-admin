# ä¼ä¸šå¾®ä¿¡èŠå¤©è®°å½•å¯¼å‡ºä¸å‰ç«¯å±•ç¤ºæŠ€æœ¯è°ƒç ”æŠ¥å‘Š

**è°ƒç ”äººå‘˜**: wangxiao
**è°ƒç ”æ—¥æœŸ**: 2025-10-04
**æŠ€æœ¯æ ˆ**: WxJava + Vue3 + SpringBoot3

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šæ·±å…¥è°ƒç ”äº†ä½¿ç”¨**WxJava SDK**å®ç°ä¼ä¸šå¾®ä¿¡èŠå¤©è®°å½•å¯¼å‡ºåŠå‰ç«¯å±•ç¤ºçš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆã€‚ä¼ä¸šå¾®ä¿¡æä¾›çš„**ä¼šè¯å†…å®¹å­˜æ¡£**åŠŸèƒ½æ˜¯ä¸€é¡¹ä»˜è´¹å¢å€¼æœåŠ¡ï¼Œé€šè¿‡å®˜æ–¹SDKå¯ä»¥å®æ—¶è·å–ã€è§£å¯†å¹¶å­˜å‚¨ä¼ä¸šå†…éƒ¨çš„èŠå¤©è®°å½•ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€è¯­éŸ³ã€æ–‡ä»¶ç­‰20+ç§æ¶ˆæ¯ç±»å‹ã€‚

**æ ¸å¿ƒç»“è®º**ï¼š
- âœ… WxJava 4.2.6+ç‰ˆæœ¬å·²æ”¯æŒä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£API
- âš ï¸ éœ€è¦ä¾èµ–ä¼ä¸šå¾®ä¿¡æä¾›çš„åŸç”Ÿåº“ï¼ˆFinance.so/dllï¼‰
- ğŸ” æ¶ˆæ¯é‡‡ç”¨RSAåŠ å¯†ï¼Œéœ€è¦å…¬ç§é’¥å¯¹è¿›è¡Œè§£å¯†
- ğŸ“¦ å¤šåª’ä½“æ–‡ä»¶éœ€è¦å•ç‹¬ä¸‹è½½å’Œå­˜å‚¨
- ğŸ¨ å‰ç«¯å¯ä½¿ç”¨Vue3èŠå¤©ç»„ä»¶åº“å®ç°æ¶ˆæ¯å±•ç¤º

---

## ğŸ¯ æŠ€æœ¯èƒŒæ™¯

### 1.1 ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£åŠŸèƒ½

ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£æ˜¯ä¼ä¸šå¾®ä¿¡æä¾›çš„ä¸€é¡¹**å¢å€¼ä»˜è´¹æœåŠ¡**ï¼Œä¸»è¦ç”¨äºï¼š
- **åˆè§„ç›‘ç®¡**ï¼šæ»¡è¶³é‡‘èã€åŒ»ç–—ç­‰è¡Œä¸šçš„ç›‘ç®¡è¦æ±‚
- **è´¨é‡ç›‘æ§**ï¼šç›‘æ§å®¢æœäººå‘˜çš„æœåŠ¡è´¨é‡
- **æ•°æ®åˆ†æ**ï¼šåˆ†æå‘˜å·¥ä¸å®¢æˆ·çš„æ²Ÿé€šæ•°æ®
- **è¯æ®ç•™å­˜**ï¼šä¿ç•™é‡è¦çš„å•†åŠ¡æ²Ÿé€šè®°å½•

**å®˜æ–¹æ–‡æ¡£**ï¼šhttps://developer.work.weixin.qq.com/document/path/91360

### 1.2 åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ¶ˆæ¯ç±»å‹** | æ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€è¯­éŸ³ã€æ–‡ä»¶ã€é“¾æ¥ã€ä½ç½®ã€å°ç¨‹åºã€åç‰‡ã€æ’¤å›æ¶ˆæ¯ç­‰20+ç§ |
| **åŠ å¯†æ–¹å¼** | RSAéå¯¹ç§°åŠ å¯† |
| **å­˜å‚¨æ–¹å¼** | ä¼ä¸šè‡ªè¡Œå­˜å‚¨ï¼ˆå®˜æ–¹åªæä¾›æ¥å£ï¼‰ |
| **æƒé™æ§åˆ¶** | éœ€åœ¨ä¼ä¸šå¾®ä¿¡åå°å¼€é€šå¹¶é…ç½® |
| **å®æ—¶æ€§** | æ”¯æŒå®æ—¶æ‹‰å–æœ€æ–°æ¶ˆæ¯ |

---

## ğŸ”§ WxJavaæŠ€æœ¯æ–¹æ¡ˆ

### 2.1 WxJavaæ”¯æŒæƒ…å†µ

**WxJava** æ˜¯ç›®å‰æœ€æµè¡Œçš„å¾®ä¿¡/ä¼ä¸šå¾®ä¿¡Java SDKï¼Œç”±å¼€æºç¤¾åŒºç»´æŠ¤ã€‚

- **GitHubä»“åº“**: https://github.com/Wechat-Group/WxJava
- **ä¼šè¯å­˜æ¡£æ”¯æŒ**: 4.2.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼ˆ2020å¹´6æœˆï¼‰
- **ç›¸å…³Issue**: [#1596 ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£API](https://github.com/Wechat-Group/WxJava/issues/1596)
- **å½“å‰ç‰ˆæœ¬**: 4.7.0ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰

### 2.2 æ ¸å¿ƒä¾èµ–

```xml
<!-- WxJavaä¼ä¸šå¾®ä¿¡æ¨¡å— -->
<dependency>
    <groupId>com.github.binarywang</groupId>
    <artifactId>weixin-java-cp</artifactId>
    <version>4.7.0</version>
</dependency>
```

**âš ï¸ å…³é”®ä¾èµ–**ï¼š
- éœ€è¦ä¼ä¸šå¾®ä¿¡å®˜æ–¹æä¾›çš„**Finance.so**(Linux)æˆ–**Finance.dll**(Windows)åŸç”Ÿåº“
- Financeç±»å¿…é¡»æ”¾åœ¨`com.tencent.wework`åŒ…è·¯å¾„ä¸‹ï¼Œå¦åˆ™ä¼šæŠ¥`UnsatisfiedLinkError`

### 2.3 æ ¸å¿ƒAPIç±»

```java
package com.tencent.wework;

public class Finance {
    // åˆå§‹åŒ–SDK
    public static native long NewSdk();

    // åˆå§‹åŒ–é…ç½®
    public static native long Init(long sdk, String corpid, String secret);

    // æ‹‰å–èŠå¤©è®°å½•
    public static native long GetChatData(long sdk, long seq, long limit,
                                          String proxy, String passwd, long timeout,
                                          long chatData);

    // è§£å¯†æ¶ˆæ¯
    public static native long DecryptData(long sdk, String encryptKey,
                                          String encryptMsg, long msg);

    // è·å–åª’ä½“æ–‡ä»¶
    public static native long GetMediaData(long sdk, String indexbuf,
                                           String sdkFileid, String proxy,
                                           String passwd, long timeout, long mediaData);

    // é”€æ¯SDK
    public static native long DestroySdk(long sdk);
}
```

**APIå‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ |
|------|------|
| `corpid` | ä¼ä¸šå¾®ä¿¡ä¼ä¸šID |
| `secret` | ä¼šè¯å­˜æ¡£Secretï¼ˆåœ¨ä¼ä¸šå¾®ä¿¡åå°è·å–ï¼‰ |
| `seq` | æ¶ˆæ¯åºåˆ—å·ï¼ˆä»0å¼€å§‹ï¼Œé€’å¢ï¼‰ |
| `limit` | æ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°é‡ï¼ˆå»ºè®®100-1000ï¼‰ |
| `encryptKey` | æ¶ˆæ¯åŠ å¯†å¯†é’¥ï¼ˆä»æ¶ˆæ¯ä½“ä¸­æå–ï¼‰ |
| `encryptMsg` | åŠ å¯†çš„æ¶ˆæ¯å†…å®¹ |

---

## ğŸ“ å®Œæ•´å®ç°æµç¨‹

### 3.1 å¼€é€šä¼šè¯å­˜æ¡£æœåŠ¡

**æ­¥éª¤1ï¼šä¼ä¸šå¾®ä¿¡åå°å¼€é€š**
1. ç™»å½•ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°ï¼šhttps://work.weixin.qq.com/
2. è¿›å…¥ã€ç®¡ç†å·¥å…·ã€‘â†’ã€ä¼šè¯å†…å®¹å­˜æ¡£ã€‘
3. ä¸‹è½½å¹¶ç­¾ç½²ã€Šä¼šè¯å­˜æ¡£ç¡®è®¤å‡½ã€‹
4. æäº¤å¼€é€šç”³è¯·ï¼ˆéœ€è¦ç­‰å¾…å®¡æ ¸ï¼‰

**æ­¥éª¤2ï¼šç”Ÿæˆå…¬ç§é’¥å¯¹**
```bash
# ä½¿ç”¨OpenSSLç”ŸæˆRSAå¯†é’¥å¯¹
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -pubout -out public.pem
```

**æ­¥éª¤3ï¼šåå°é…ç½®**
- ä¸Šä¼ å…¬é’¥åˆ°ä¼ä¸šå¾®ä¿¡åå°
- é…ç½®æœåŠ¡å™¨IPç™½åå•
- è·å–ä¼šè¯å­˜æ¡£Secret

### 3.2 åç«¯å®ç°ï¼ˆJava + SpringBoot3ï¼‰

#### 3.2.1 é¡¹ç›®ç»“æ„

```
src/main/java/
â””â”€â”€ net/lab1024/sa/admin/
    â””â”€â”€ module/business/wecom/
        â”œâ”€â”€ controller/
        â”‚   â””â”€â”€ WecomChatArchiveController.java
        â”œâ”€â”€ service/
        â”‚   â”œâ”€â”€ WecomChatArchiveService.java
        â”‚   â””â”€â”€ WecomMessageDecryptService.java
        â”œâ”€â”€ manager/
        â”‚   â””â”€â”€ WecomFinanceManager.java
        â”œâ”€â”€ dao/
        â”‚   â””â”€â”€ WecomChatArchiveDao.java
        â”œâ”€â”€ domain/
        â”‚   â”œâ”€â”€ entity/WecomChatMessageEntity.java
        â”‚   â”œâ”€â”€ form/WecomChatQueryForm.java
        â”‚   â””â”€â”€ vo/WecomChatMessageVO.java
        â””â”€â”€ constant/
            â””â”€â”€ WecomMessageTypeEnum.java

src/main/resources/
â””â”€â”€ wecom/
    â”œâ”€â”€ Finance.so          # LinuxåŸç”Ÿåº“
    â””â”€â”€ Finance.dll         # WindowsåŸç”Ÿåº“
```

#### 3.2.2 æ ¸å¿ƒä»£ç å®ç°

**Financeç®¡ç†å™¨**ï¼š
```java
/*
 * ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£Finance SDKç®¡ç†å™¨
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */
@Component
public class WecomFinanceManager {

    private long sdk;

    @Value("${wecom.corpid}")
    private String corpId;

    @Value("${wecom.chat-archive.secret}")
    private String secret;

    @PostConstruct
    public void init() {
        // åŠ è½½åŸç”Ÿåº“
        loadNativeLibrary();

        // åˆå§‹åŒ–SDK
        sdk = Finance.NewSdk();
        long ret = Finance.Init(sdk, corpId, secret);
        if (ret != 0) {
            throw new BusinessException("ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£SDKåˆå§‹åŒ–å¤±è´¥");
        }
    }

    /**
     * åŠ è½½åŸç”Ÿåº“ @author wangxiao
     */
    private void loadNativeLibrary() {
        String osName = System.getProperty("os.name").toLowerCase();
        String libName = osName.contains("windows") ? "Finance.dll" : "libWeWorkFinanceSdk_Java.so";

        try {
            // ä»resourcesç›®å½•å¤åˆ¶åˆ°ä¸´æ—¶ç›®å½•
            Path tempDir = Files.createTempDirectory("wecom");
            Path libPath = tempDir.resolve(libName);

            try (InputStream is = getClass().getResourceAsStream("/wecom/" + libName)) {
                Files.copy(is, libPath, StandardCopyOption.REPLACE_EXISTING);
            }

            // åŠ è½½åº“
            System.load(libPath.toString());
        } catch (Exception e) {
            throw new BusinessException("åŠ è½½ä¼ä¸šå¾®ä¿¡åŸç”Ÿåº“å¤±è´¥", e);
        }
    }

    /**
     * æ‹‰å–èŠå¤©è®°å½• @author wangxiao
     */
    public String getChatData(long seq, long limit) {
        long chatData = Finance.NewChatData();
        long ret = Finance.GetChatData(sdk, seq, limit, "", "", 10, chatData);

        if (ret != 0) {
            Finance.FreeChatData(chatData);
            throw new BusinessException("æ‹‰å–èŠå¤©è®°å½•å¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + ret);
        }

        String data = Finance.GetChatDataContent(chatData);
        Finance.FreeChatData(chatData);
        return data;
    }

    /**
     * è§£å¯†æ¶ˆæ¯ @author wangxiao
     */
    public String decryptMessage(String encryptKey, String encryptMsg) {
        long msg = Finance.NewSlice();
        long ret = Finance.DecryptData(sdk, encryptKey, encryptMsg, msg);

        if (ret != 0) {
            Finance.FreeSlice(msg);
            throw new BusinessException("æ¶ˆæ¯è§£å¯†å¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + ret);
        }

        String plaintext = Finance.GetSliceContent(msg);
        Finance.FreeSlice(msg);
        return plaintext;
    }

    /**
     * ä¸‹è½½åª’ä½“æ–‡ä»¶ @author wangxiao
     */
    public byte[] getMediaData(String sdkFileId, String indexBuf) {
        long mediaData = Finance.NewMediaData();
        long ret = Finance.GetMediaData(sdk, indexBuf, sdkFileId, "", "", 10, mediaData);

        if (ret != 0) {
            Finance.FreeMediaData(mediaData);
            throw new BusinessException("ä¸‹è½½åª’ä½“æ–‡ä»¶å¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + ret);
        }

        byte[] data = Finance.GetMediaDataContent(mediaData);
        Finance.FreeMediaData(mediaData);
        return data;
    }

    @PreDestroy
    public void destroy() {
        if (sdk != 0) {
            Finance.DestroySdk(sdk);
        }
    }
}
```

**Serviceå±‚å®ç°**ï¼š
```java
/*
 * ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£æœåŠ¡
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */
@Service
public class WecomChatArchiveService {

    @Resource
    private WecomFinanceManager financeManager;

    @Resource
    private WecomMessageDecryptService decryptService;

    @Resource
    private WecomChatArchiveDao chatArchiveDao;

    /**
     * åŒæ­¥èŠå¤©è®°å½• @author wangxiao
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Integer> syncChatMessages() {
        // è·å–ä¸Šæ¬¡åŒæ­¥çš„seq
        Long lastSeq = chatArchiveDao.getLastSeq();
        long currentSeq = lastSeq != null ? lastSeq : 0;

        int totalCount = 0;
        boolean hasMore = true;

        while (hasMore) {
            // æ‹‰å–æ¶ˆæ¯ï¼ˆæ¯æ¬¡1000æ¡ï¼‰
            String jsonData = financeManager.getChatData(currentSeq, 1000);
            JSONObject jsonObject = JSON.parseObject(jsonData);

            JSONArray chatDataArray = jsonObject.getJSONArray("chatdata");
            if (chatDataArray == null || chatDataArray.isEmpty()) {
                hasMore = false;
                break;
            }

            // è§£å¯†å¹¶ä¿å­˜æ¶ˆæ¯
            for (int i = 0; i < chatDataArray.size(); i++) {
                JSONObject item = chatDataArray.getJSONObject(i);

                // è§£å¯†æ¶ˆæ¯
                String encryptKey = item.getString("encrypt_random_key");
                String encryptChat = item.getString("encrypt_chat_msg");
                String plaintext = financeManager.decryptMessage(encryptKey, encryptChat);

                // è§£ææ¶ˆæ¯
                WecomChatMessageEntity message = parseMessage(plaintext);
                message.setSeq(item.getLong("seq"));

                // å¤„ç†å¤šåª’ä½“æ–‡ä»¶
                if (needDownloadMedia(message.getMsgType())) {
                    processMediaFile(message);
                }

                // ä¿å­˜åˆ°æ•°æ®åº“
                chatArchiveDao.insert(message);
                totalCount++;

                // æ›´æ–°seq
                currentSeq = item.getLong("seq");
            }
        }

        return ResponseDTO.ok(totalCount);
    }

    /**
     * åˆ†é¡µæŸ¥è¯¢èŠå¤©è®°å½• @author wangxiao
     */
    public ResponseDTO<PageResult<WecomChatMessageVO>> queryPage(WecomChatQueryForm form) {
        Page<WecomChatMessageEntity> page = chatArchiveDao.queryPage(form);
        PageResult<WecomChatMessageVO> pageResult = SmartPageUtil.convert(page, WecomChatMessageVO.class);
        return ResponseDTO.ok(pageResult);
    }

    /**
     * è§£ææ¶ˆæ¯ @author wangxiao
     */
    private WecomChatMessageEntity parseMessage(String plaintext) {
        JSONObject msgObj = JSON.parseObject(plaintext);

        WecomChatMessageEntity message = new WecomChatMessageEntity();
        message.setMsgId(msgObj.getString("msgid"));
        message.setMsgType(msgObj.getString("msgtype"));
        message.setMsgTime(msgObj.getLong("msgtime"));
        message.setFromUser(msgObj.getString("from"));
        message.setToList(msgObj.getString("tolist"));
        message.setRoomId(msgObj.getString("roomid"));
        message.setContent(plaintext);

        return message;
    }

    /**
     * åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸‹è½½åª’ä½“æ–‡ä»¶ @author wangxiao
     */
    private boolean needDownloadMedia(String msgType) {
        return "image".equals(msgType) || "video".equals(msgType)
            || "voice".equals(msgType) || "file".equals(msgType);
    }

    /**
     * å¤„ç†åª’ä½“æ–‡ä»¶ @author wangxiao
     */
    private void processMediaFile(WecomChatMessageEntity message) {
        JSONObject content = JSON.parseObject(message.getContent());
        String sdkFileId = content.getString("sdkfileid");

        if (StringUtils.isBlank(sdkFileId)) {
            return;
        }

        // ä¸‹è½½æ–‡ä»¶
        byte[] fileData = financeManager.getMediaData(sdkFileId, "");

        // ä¸Šä¼ åˆ°OSSæˆ–æœ¬åœ°å­˜å‚¨
        String fileUrl = uploadToStorage(fileData, message.getMsgType());

        // æ›´æ–°æ¶ˆæ¯ä¸­çš„æ–‡ä»¶è·¯å¾„
        content.put("file_url", fileUrl);
        message.setContent(content.toJSONString());
    }

    /**
     * ä¸Šä¼ æ–‡ä»¶åˆ°å­˜å‚¨ @author wangxiao
     */
    private String uploadToStorage(byte[] fileData, String msgType) {
        // TODO: å®ç°æ–‡ä»¶ä¸Šä¼ é€»è¾‘ï¼ˆOSS/æœ¬åœ°å­˜å‚¨ï¼‰
        return "http://example.com/file/" + UUID.randomUUID();
    }
}
```

**Controllerå±‚**ï¼š
```java
/*
 * ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£Controller
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */
@RestController
@Tag(name = SwaggerTagConst.Business.WECOM_CHAT_ARCHIVE)
public class WecomChatArchiveController {

    @Resource
    private WecomChatArchiveService chatArchiveService;

    /**
     * åŒæ­¥èŠå¤©è®°å½• @author wangxiao
     */
    @Operation(summary = "åŒæ­¥èŠå¤©è®°å½• @author wangxiao")
    @PostMapping("/business/wecom/chat-archive/sync")
    @SaCheckPermission("wecom:chat-archive:sync")
    public ResponseDTO<Integer> syncChatMessages() {
        return chatArchiveService.syncChatMessages();
    }

    /**
     * åˆ†é¡µæŸ¥è¯¢èŠå¤©è®°å½• @author wangxiao
     */
    @Operation(summary = "åˆ†é¡µæŸ¥è¯¢èŠå¤©è®°å½• @author wangxiao")
    @PostMapping("/business/wecom/chat-archive/queryPage")
    @SaCheckPermission("wecom:chat-archive:query")
    public ResponseDTO<PageResult<WecomChatMessageVO>> queryPage(
            @RequestBody @Valid WecomChatQueryForm form) {
        return chatArchiveService.queryPage(form);
    }
}
```

#### 3.2.3 æ¶ˆæ¯ç±»å‹æšä¸¾

```java
/*
 * ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯ç±»å‹æšä¸¾
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */
public enum WecomMessageTypeEnum implements ErrorCode {
    TEXT(1, "æ–‡æœ¬æ¶ˆæ¯"),
    IMAGE(2, "å›¾ç‰‡æ¶ˆæ¯"),
    REVOKE(3, "æ’¤å›æ¶ˆæ¯"),
    AGREE(4, "åŒæ„ä¼šè¯èŠå¤©å†…å®¹"),
    DISAGREE(5, "ä¸åŒæ„ä¼šè¯èŠå¤©å†…å®¹"),
    VOICE(6, "è¯­éŸ³æ¶ˆæ¯"),
    VIDEO(7, "è§†é¢‘æ¶ˆæ¯"),
    CARD(8, "åç‰‡æ¶ˆæ¯"),
    LOCATION(9, "ä½ç½®æ¶ˆæ¯"),
    EMOTION(10, "è¡¨æƒ…æ¶ˆæ¯"),
    FILE(11, "æ–‡ä»¶æ¶ˆæ¯"),
    LINK(12, "é“¾æ¥æ¶ˆæ¯"),
    WEAPP(13, "å°ç¨‹åºæ¶ˆæ¯"),
    CHATRECORD(14, "ä¼šè¯è®°å½•æ¶ˆæ¯"),
    TODO(15, "å¾…åŠæ¶ˆæ¯"),
    VOTE(16, "æŠ•ç¥¨æ¶ˆæ¯"),
    COLLECT(17, "å¡«è¡¨æ¶ˆæ¯"),
    REDPACKET(18, "çº¢åŒ…æ¶ˆæ¯"),
    MEETING(19, "ä¼šè®®é‚€è¯·æ¶ˆæ¯"),
    DOCMSG(20, "åœ¨çº¿æ–‡æ¡£æ¶ˆæ¯"),
    MARKDOWN(21, "MarkDownæ ¼å¼æ¶ˆæ¯"),
    NEWS(22, "å›¾æ–‡æ¶ˆæ¯"),
    CALENDAR(23, "æ—¥ç¨‹æ¶ˆæ¯"),
    MIXED(24, "æ··åˆæ¶ˆæ¯"),
    MEETING_VOICE_CALL(25, "éŸ³é¢‘å­˜æ¡£æ¶ˆæ¯"),
    VOIP_DOC_SHARE(26, "éŸ³é¢‘å…±äº«æ–‡æ¡£æ¶ˆæ¯"),
    EXTERNAL_REDPACKET(27, "äº’é€šçº¢åŒ…æ¶ˆæ¯"),
    SPHFEED(28, "è§†é¢‘å·æ¶ˆæ¯");

    private final Integer value;
    private final String desc;

    // æ„é€ å‡½æ•°å’Œæ–¹æ³•çœç•¥...
}
```

### 3.3 å‰ç«¯å®ç°ï¼ˆVue3 + TypeScriptï¼‰

#### 3.3.1 é¡¹ç›®ç»“æ„

```
smart-admin-web-typescript/src/
â”œâ”€â”€ api/business/wecom/
â”‚   â”œâ”€â”€ chat-archive-api.ts
â”‚   â””â”€â”€ chat-archive-model.ts
â”œâ”€â”€ constants/business/wecom/
â”‚   â””â”€â”€ chat-archive-const.ts
â”œâ”€â”€ components/business/wecom/
â”‚   â”œâ”€â”€ ChatMessageList.vue
â”‚   â”œâ”€â”€ ChatMessageItem.vue
â”‚   â””â”€â”€ ChatMediaPreview.vue
â””â”€â”€ views/business/wecom/
    â””â”€â”€ chat-archive-list.vue
```

#### 3.3.2 APIå’ŒModelå®šä¹‰

**chat-archive-api.ts**ï¼š
```typescript
/*
 * ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£API
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */
import { postRequest } from '@/lib/axios';
import type {
  WecomChatQueryForm,
  WecomChatMessageVO,
  PageResultModel
} from './chat-archive-model';

export const wecomChatArchiveApi = {
  /**
   * åŒæ­¥èŠå¤©è®°å½• @author wangxiao
   */
  syncMessages: () => {
    return postRequest<number>('/business/wecom/chat-archive/sync', {});
  },

  /**
   * åˆ†é¡µæŸ¥è¯¢èŠå¤©è®°å½• @author wangxiao
   */
  queryPage: (param: WecomChatQueryForm) => {
    return postRequest<PageResultModel<WecomChatMessageVO>>(
      '/business/wecom/chat-archive/queryPage',
      param
    );
  },
};
```

**chat-archive-model.ts**ï¼š
```typescript
/*
 * ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£Model
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */

// æŸ¥è¯¢è¡¨å•
export interface WecomChatQueryForm extends PageParam {
  fromUser?: string;      // å‘é€è€…
  toUser?: string;        // æ¥æ”¶è€…
  roomId?: string;        // ç¾¤èŠID
  msgType?: string;       // æ¶ˆæ¯ç±»å‹
  startTime?: number;     // å¼€å§‹æ—¶é—´
  endTime?: number;       // ç»“æŸæ—¶é—´
  keyword?: string;       // å…³é”®è¯
}

// æ¶ˆæ¯VO
export interface WecomChatMessageVO {
  id: number;
  msgId: string;
  msgType: string;
  msgTime: number;
  fromUser: string;
  fromUserName?: string;
  toList: string;
  roomId?: string;
  roomName?: string;
  content: string;
  contentParsed?: MessageContent;
  seq: number;
  createTime: string;
}

// æ¶ˆæ¯å†…å®¹ï¼ˆæ ¹æ®msgTypeä¸åŒï¼Œcontentå­—æ®µè§£æåçš„ç»“æ„ï¼‰
export interface MessageContent {
  // æ–‡æœ¬æ¶ˆæ¯
  text?: {
    content: string;
  };

  // å›¾ç‰‡æ¶ˆæ¯
  image?: {
    sdkfileid: string;
    md5sum: string;
    filesize: number;
    file_url?: string;
  };

  // è§†é¢‘æ¶ˆæ¯
  video?: {
    sdkfileid: string;
    filesize: number;
    play_length: number;
    md5sum: string;
    file_url?: string;
  };

  // è¯­éŸ³æ¶ˆæ¯
  voice?: {
    sdkfileid: string;
    voice_size: number;
    play_length: number;
    md5sum: string;
    file_url?: string;
  };

  // æ–‡ä»¶æ¶ˆæ¯
  file?: {
    filename: string;
    fileext: string;
    sdkfileid: string;
    filesize: number;
    md5sum: string;
    file_url?: string;
  };

  // å…¶ä»–ç±»å‹...
}
```

**chat-archive-const.ts**ï¼š
```typescript
/*
 * ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£å¸¸é‡
 *
 * @Author:    wangxiao
 * @Date:      2025-10-04
 * @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
 */
import type { SmartEnum } from '@/types';

/**
 * æ¶ˆæ¯ç±»å‹æšä¸¾
 */
export const MESSAGE_TYPE_ENUM: SmartEnum<string> = {
  TEXT: { value: 'text', desc: 'æ–‡æœ¬æ¶ˆæ¯' },
  IMAGE: { value: 'image', desc: 'å›¾ç‰‡æ¶ˆæ¯' },
  REVOKE: { value: 'revoke', desc: 'æ’¤å›æ¶ˆæ¯' },
  VOICE: { value: 'voice', desc: 'è¯­éŸ³æ¶ˆæ¯' },
  VIDEO: { value: 'video', desc: 'è§†é¢‘æ¶ˆæ¯' },
  CARD: { value: 'card', desc: 'åç‰‡æ¶ˆæ¯' },
  LOCATION: { value: 'location', desc: 'ä½ç½®æ¶ˆæ¯' },
  EMOTION: { value: 'emotion', desc: 'è¡¨æƒ…æ¶ˆæ¯' },
  FILE: { value: 'file', desc: 'æ–‡ä»¶æ¶ˆæ¯' },
  LINK: { value: 'link', desc: 'é“¾æ¥æ¶ˆæ¯' },
  WEAPP: { value: 'weapp', desc: 'å°ç¨‹åºæ¶ˆæ¯' },
};
```

#### 3.3.3 èŠå¤©æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶

**ChatMessageList.vue**ï¼š
```vue
<!--
  ä¼ä¸šå¾®ä¿¡èŠå¤©è®°å½•åˆ—è¡¨ç»„ä»¶

  @Author:    wangxiao
  @Date:      2025-10-04
  @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
-->
<template>
  <div class="chat-message-list">
    <a-spin :spinning="loading">
      <div
        ref="messageContainer"
        class="message-container"
        @scroll="handleScroll"
      >
        <div
          v-for="message in messages"
          :key="message.msgId"
          class="message-wrapper"
        >
          <ChatMessageItem :message="message" />
        </div>

        <div v-if="hasMore" class="load-more">
          <a-button @click="loadMore">åŠ è½½æ›´å¤š</a-button>
        </div>
      </div>
    </a-spin>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, nextTick } from 'vue';
import { message as antMessage } from 'ant-design-vue';
import { wecomChatArchiveApi } from '@/api/business/wecom/chat-archive-api';
import ChatMessageItem from './ChatMessageItem.vue';
import type { WecomChatMessageVO, WecomChatQueryForm } from '@/api/business/wecom/chat-archive-model';

// Props
interface Props {
  queryForm?: WecomChatQueryForm;
}

const props = withDefaults(defineProps<Props>(), {
  queryForm: () => ({ pageNum: 1, pageSize: 20 }),
});

// æ•°æ®
const loading = ref(false);
const messages = ref<WecomChatMessageVO[]>([]);
const hasMore = ref(true);
const currentPage = ref(1);
const messageContainer = ref<HTMLDivElement>();

// åŠ è½½æ¶ˆæ¯
const loadMessages = async (append = false) => {
  loading.value = true;
  try {
    const form = {
      ...props.queryForm,
      pageNum: currentPage.value,
      pageSize: 20,
    };

    const res = await wecomChatArchiveApi.queryPage(form);

    if (append) {
      messages.value.push(...res.data.list);
    } else {
      messages.value = res.data.list;
      // æ»šåŠ¨åˆ°åº•éƒ¨
      await nextTick();
      scrollToBottom();
    }

    hasMore.value = res.data.pageNum < res.data.pages;
  } catch (error) {
    antMessage.error('åŠ è½½èŠå¤©è®°å½•å¤±è´¥');
  } finally {
    loading.value = false;
  }
};

// åŠ è½½æ›´å¤š
const loadMore = () => {
  currentPage.value++;
  loadMessages(true);
};

// æ»šåŠ¨åˆ°åº•éƒ¨
const scrollToBottom = () => {
  if (messageContainer.value) {
    messageContainer.value.scrollTop = messageContainer.value.scrollHeight;
  }
};

// å¤„ç†æ»šåŠ¨
const handleScroll = () => {
  // å¯ä»¥åœ¨è¿™é‡Œå®ç°è™šæ‹Ÿæ»šåŠ¨ç­‰ä¼˜åŒ–
};

// åˆå§‹åŒ–
onMounted(() => {
  loadMessages();
});

// æš´éœ²æ–¹æ³•
defineExpose({
  refresh: () => {
    currentPage.value = 1;
    loadMessages();
  },
});
</script>

<style scoped lang="less">
.chat-message-list {
  height: 100%;

  .message-container {
    height: calc(100vh - 200px);
    overflow-y: auto;
    padding: 16px;
    background: #f5f5f5;

    .message-wrapper {
      margin-bottom: 12px;
    }

    .load-more {
      text-align: center;
      padding: 16px;
    }
  }
}
</style>
```

**ChatMessageItem.vue**ï¼š
```vue
<!--
  èŠå¤©æ¶ˆæ¯é¡¹ç»„ä»¶

  @Author:    wangxiao
  @Date:      2025-10-04
  @Copyright  å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€ 2025
-->
<template>
  <div class="chat-message-item">
    <!-- æ¶ˆæ¯å¤´éƒ¨ï¼šå‘é€è€… + æ—¶é—´ -->
    <div class="message-header">
      <a-avatar :src="getUserAvatar(message.fromUser)" />
      <span class="user-name">{{ message.fromUserName }}</span>
      <span class="message-time">{{ formatTime(message.msgTime) }}</span>
    </div>

    <!-- æ¶ˆæ¯å†…å®¹ï¼šæ ¹æ®ç±»å‹æ¸²æŸ“ -->
    <div class="message-content">
      <!-- æ–‡æœ¬æ¶ˆæ¯ -->
      <div v-if="message.msgType === 'text'" class="text-message">
        {{ parseContent().text?.content }}
      </div>

      <!-- å›¾ç‰‡æ¶ˆæ¯ -->
      <div v-else-if="message.msgType === 'image'" class="image-message">
        <a-image
          :src="parseContent().image?.file_url"
          :preview="true"
          style="max-width: 200px"
        />
      </div>

      <!-- è§†é¢‘æ¶ˆæ¯ -->
      <div v-else-if="message.msgType === 'video'" class="video-message">
        <video
          :src="parseContent().video?.file_url"
          controls
          style="max-width: 300px"
        />
      </div>

      <!-- è¯­éŸ³æ¶ˆæ¯ -->
      <div v-else-if="message.msgType === 'voice'" class="voice-message">
        <a-button @click="playVoice">
          <template #icon><SoundOutlined /></template>
          è¯­éŸ³æ¶ˆæ¯ {{ parseContent().voice?.play_length }}ç§’
        </a-button>
      </div>

      <!-- æ–‡ä»¶æ¶ˆæ¯ -->
      <div v-else-if="message.msgType === 'file'" class="file-message">
        <a-button @click="downloadFile">
          <template #icon><FileOutlined /></template>
          {{ parseContent().file?.filename }}
        </a-button>
      </div>

      <!-- æ’¤å›æ¶ˆæ¯ -->
      <div v-else-if="message.msgType === 'revoke'" class="revoke-message">
        <span style="color: #999">æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯</span>
      </div>

      <!-- å…¶ä»–ç±»å‹ -->
      <div v-else class="unknown-message">
        <a-tag color="blue">{{ MESSAGE_TYPE_ENUM[message.msgType.toUpperCase()]?.desc || 'æœªçŸ¥æ¶ˆæ¯' }}</a-tag>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { SoundOutlined, FileOutlined } from '@ant-design/icons-vue';
import type { WecomChatMessageVO, MessageContent } from '@/api/business/wecom/chat-archive-model';
import { MESSAGE_TYPE_ENUM } from '@/constants/business/wecom/chat-archive-const';
import dayjs from 'dayjs';

interface Props {
  message: WecomChatMessageVO;
}

const props = defineProps<Props>();

// è§£ææ¶ˆæ¯å†…å®¹
const parseContent = (): MessageContent => {
  try {
    return JSON.parse(props.message.content) as MessageContent;
  } catch {
    return {};
  }
};

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (timestamp: number) => {
  return dayjs(timestamp * 1000).format('YYYY-MM-DD HH:mm:ss');
};

// è·å–ç”¨æˆ·å¤´åƒ
const getUserAvatar = (userId: string) => {
  return `https://api.dicebear.com/7.x/avataaars/svg?seed=${userId}`;
};

// æ’­æ”¾è¯­éŸ³
const playVoice = () => {
  const audio = new Audio(parseContent().voice?.file_url);
  audio.play();
};

// ä¸‹è½½æ–‡ä»¶
const downloadFile = () => {
  const fileUrl = parseContent().file?.file_url;
  if (fileUrl) {
    window.open(fileUrl, '_blank');
  }
};
</script>

<style scoped lang="less">
.chat-message-item {
  background: white;
  border-radius: 8px;
  padding: 12px;

  .message-header {
    display: flex;
    align-items: center;
    margin-bottom: 8px;

    .user-name {
      margin-left: 8px;
      font-weight: 500;
    }

    .message-time {
      margin-left: auto;
      color: #999;
      font-size: 12px;
    }
  }

  .message-content {
    margin-left: 40px;

    .text-message {
      line-height: 1.6;
      word-break: break-word;
    }

    .revoke-message {
      font-style: italic;
    }
  }
}
</style>
```

---

## âš ï¸ æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 4.1 åŸç”Ÿåº“ä¾èµ–å’Œè·¨å¹³å°éƒ¨ç½²

**éš¾ç‚¹**ï¼š
- Finance.so/dllå¿…é¡»æ”¾åœ¨ç‰¹å®šåŒ…è·¯å¾„`com.tencent.wework`ä¸‹
- Windowså’ŒLinuxéœ€è¦ä¸åŒçš„åº“æ–‡ä»¶
- Dockeréƒ¨ç½²æ—¶éœ€è¦æ­£ç¡®æ˜ å°„soæ–‡ä»¶è·¯å¾„

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// åŠ¨æ€åŠ è½½åŸç”Ÿåº“
private void loadNativeLibrary() {
    String osName = System.getProperty("os.name").toLowerCase();
    String libName = osName.contains("windows") ? "Finance.dll" : "libWeWorkFinanceSdk_Java.so";

    // ä»resourceså¤åˆ¶åˆ°ä¸´æ—¶ç›®å½•
    Path tempDir = Files.createTempDirectory("wecom");
    Path libPath = tempDir.resolve(libName);

    try (InputStream is = getClass().getResourceAsStream("/wecom/" + libName)) {
        Files.copy(is, libPath, StandardCopyOption.REPLACE_EXISTING);
    }

    System.load(libPath.toString());
}
```

### 4.2 æ¶ˆæ¯åŠ å¯†è§£å¯†

**éš¾ç‚¹**ï¼š
- æ¶ˆæ¯ä½¿ç”¨RSAåŠ å¯†
- `publickey_ver`ç‰ˆæœ¬å·å¿…é¡»åŒ¹é…
- æ›´æ–°å…¬é’¥ååªæœ‰æ–°æ¶ˆæ¯ä½¿ç”¨æ–°ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¿å­˜å¤šä¸ªç‰ˆæœ¬çš„ç§é’¥
2. æ ¹æ®æ¶ˆæ¯ä¸­çš„`publickey_ver`é€‰æ‹©å¯¹åº”ç§é’¥è§£å¯†
3. è§£å¯†å¤±è´¥æ—¶è®°å½•æ—¥å¿—å¹¶è·³è¿‡ï¼Œä¸å½±å“åç»­æ¶ˆæ¯

### 4.3 å¤§é‡æ•°æ®å¤„ç†å’Œæ€§èƒ½

**éš¾ç‚¹**ï¼š
- ä¼šè¯å­˜æ¡£ä¼šäº§ç”Ÿæµ·é‡æ•°æ®
- åŒæ­¥è¿‡ç¨‹ä¸­å¯èƒ½å¯¼è‡´JVMå´©æºƒï¼ˆIssue #3670ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **åˆ†é¡µæ‹‰å–**ï¼šæ¯æ¬¡æ‹‰å–1000æ¡ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤š
2. **æ‰¹é‡æ’å…¥**ï¼šä½¿ç”¨MyBatis-Plusçš„`saveBatch`æ‰¹é‡æ’å…¥æ•°æ®åº“
3. **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨`@Async`å¼‚æ­¥åŒæ­¥æ¶ˆæ¯ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
4. **å®šæ—¶ä»»åŠ¡**ï¼šä½¿ç”¨Quartzå®šæ—¶æ‹‰å–å¢é‡æ¶ˆæ¯
5. **é™æµå’Œé‡è¯•**ï¼šåŠ å…¥é™æµæœºåˆ¶ï¼Œé¿å…é¢‘ç¹è°ƒç”¨API

```java
@Async
@Scheduled(cron = "0 */5 * * * ?")  // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
public void scheduleSyncMessages() {
    try {
        syncChatMessages();
    } catch (Exception e) {
        log.error("å®šæ—¶åŒæ­¥èŠå¤©è®°å½•å¤±è´¥", e);
    }
}
```

### 4.4 å¤šåª’ä½“æ–‡ä»¶å¤„ç†

**éš¾ç‚¹**ï¼š
- å›¾ç‰‡ã€è§†é¢‘ã€æ–‡ä»¶éœ€è¦å•ç‹¬ä¸‹è½½
- å¤§æ–‡ä»¶å­˜å‚¨éœ€è¦å¯¹è±¡å­˜å‚¨
- æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œä¸‹è½½è€—æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **å»¶è¿Ÿä¸‹è½½**ï¼šå…ˆä¿å­˜æ¶ˆæ¯è®°å½•ï¼Œæ–‡ä»¶æŒ‰éœ€ä¸‹è½½
2. **OSSå­˜å‚¨**ï¼šä½¿ç”¨é˜¿é‡Œäº‘OSSæˆ–MinIOå­˜å‚¨æ–‡ä»¶
3. **CDNåŠ é€Ÿ**ï¼šé€šè¿‡CDNåŠ é€Ÿæ–‡ä»¶è®¿é—®
4. **å‹ç¼©ä¼˜åŒ–**ï¼šå›¾ç‰‡ã€è§†é¢‘è¿›è¡Œå‹ç¼©å¤„ç†

```java
// å¼‚æ­¥ä¸‹è½½åª’ä½“æ–‡ä»¶
@Async
public void downloadMediaFileAsync(String msgId, String sdkFileId) {
    byte[] fileData = financeManager.getMediaData(sdkFileId, "");
    String ossUrl = ossService.upload(fileData, msgId);
    chatArchiveDao.updateFileUrl(msgId, ossUrl);
}
```

### 4.5 æƒé™å’Œé…ç½®

**éš¾ç‚¹**ï¼š
- éœ€è¦åœ¨ä¼ä¸šå¾®ä¿¡åå°å¼€é€šä¼šè¯å­˜æ¡£
- å¯èƒ½å‡ºç°"APIæ¥å£æ— æƒé™è°ƒç”¨"é”™è¯¯ï¼ˆIssue #3563ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **æƒé™æ£€æŸ¥**ï¼šè°ƒç”¨APIå‰å…ˆæ£€æŸ¥ä¼ä¸šæ˜¯å¦å¼€é€šä¼šè¯å­˜æ¡£
2. **é…ç½®éªŒè¯**ï¼šå¯åŠ¨æ—¶éªŒè¯Secretã€å…¬é’¥ç­‰é…ç½®æ˜¯å¦æ­£ç¡®
3. **é”™è¯¯å¤„ç†**ï¼šæ•è·æƒé™é”™è¯¯ï¼Œç»™å‡ºæ˜ç¡®æç¤º

```java
@PostConstruct
public void checkPermission() {
    try {
        // è°ƒç”¨APIæµ‹è¯•æƒé™
        financeManager.getChatData(0, 1);
    } catch (BusinessException e) {
        log.error("ä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£æƒé™éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥åå°é…ç½®");
        throw e;
    }
}
```

### 4.6 æ¶ˆæ¯ç±»å‹å¤šæ ·æ€§

**éš¾ç‚¹**ï¼š
- ä¼ä¸šå¾®ä¿¡æ”¯æŒ20+ç§æ¶ˆæ¯ç±»å‹
- æŸäº›æ–°ç±»å‹å¯èƒ½æœªè¦†ç›–ï¼ˆå¦‚è§†é¢‘é€šè¯ï¼ŒIssue #3598ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ç±»å‹æšä¸¾**ï¼šå®šä¹‰å®Œæ•´çš„`WecomMessageTypeEnum`
2. **é™çº§å¤„ç†**ï¼šæœªçŸ¥ç±»å‹æ˜¾ç¤ºä¸º"æœªçŸ¥æ¶ˆæ¯"
3. **åŠ¨æ€æ‰©å±•**ï¼šæ–°ç±»å‹å¯é€šè¿‡é…ç½®å¿«é€Ÿæ”¯æŒ

```typescript
// å‰ç«¯é™çº§å¤„ç†
<div v-else class="unknown-message">
  <a-tag>{{ MESSAGE_TYPE_ENUM[message.msgType]?.desc || 'æœªçŸ¥æ¶ˆæ¯' }}</a-tag>
</div>
```

---

## ğŸ“Š å¼€æºé¡¹ç›®å‚è€ƒ

### 5.1 WeworkChatSDK

**GitHub**: https://github.com/chinayin/WeworkChatSDK

**ç‰¹æ€§**ï¼š
- âœ… æä¾›ä¸€é”®æ¥å…¥çš„Java SDK
- âœ… æ”¯æŒæŠ•é€’æ•°æ®åˆ°é˜¿é‡Œäº‘MNSã€OSS
- âœ… å¤šçº¿ç¨‹å®æ—¶å¤„ç†èŠå¤©æ•°æ®
- âœ… å¼€ç®±å³ç”¨çš„Dockeréƒ¨ç½²æ–¹æ¡ˆ

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// åˆå§‹åŒ–SDK
WeWorkChatSDK sdk = new WeWorkChatSDK(corpId, secret, privateKey);

// æ‹‰å–æ¶ˆæ¯
sdk.startPull((message) -> {
    // å¤„ç†æ¶ˆæ¯
    System.out.println(message.toJSONString());
});
```

### 5.2 WeWorkFinanceSdk (Pythonç‰ˆ)

**GitHub**: https://github.com/oiuv/WeWorkFinanceSdk

**ç‰¹æ€§**ï¼š
- âœ… Pythonè°ƒç”¨Cç‰ˆæœ¬Linux soåº“
- âœ… è‡ªåŠ¨å­˜æ¡£æ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³ã€è§†é¢‘ã€æ–‡ä»¶
- âœ… å¯¼å‡ºåˆ°Excel/JSONæ ¼å¼

---

## ğŸ¨ å‰ç«¯UIç»„ä»¶æ¨è

### 6.1 Ant Design X Vue

**å®˜ç½‘**: https://antd-design-x-vue.netlify.app/

**ç‰¹æ€§**ï¼š
- âœ… é«˜åº¦å®šåˆ¶åŒ–çš„AIèŠå¤©ç»„ä»¶
- âœ… æ”¯æŒå¯¹è¯æµã€æ°”æ³¡ã€æ¶ˆæ¯åˆ—è¡¨ç­‰
- âœ… å¼€ç®±å³ç”¨çš„ä»¤ç‰Œç®¡ç†API

### 6.2 m-chatï¼ˆVue2/3å…¼å®¹ï¼‰

**GitHub**: https://github.com/mengxiong10/m-chat
**æ˜é‡‘æ–‡ç« **: https://juejin.cn/post/6990998089783836708

**ç‰¹æ€§**ï¼š
- âœ… æ–‡å­—ã€å›¾ç‰‡ã€è§†é¢‘ã€è¯­éŸ³å±•ç¤º
- âœ… å›¾ç‰‡é¢„è§ˆã€è§†é¢‘æ’­æ”¾
- âœ… æ”¯æŒè‡ªå®šä¹‰æ ·å¼

---

## ğŸ“‹ å®æ–½å»ºè®®

### 7.1 å¼€å‘é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | ä»»åŠ¡ | é¢„ä¼°æ—¶é—´ |
|------|------|----------|
| **Phase 1** | åç«¯SDKé›†æˆã€æ¶ˆæ¯æ‹‰å–è§£å¯† | 3-5å¤© |
| **Phase 2** | æ•°æ®åº“è®¾è®¡ã€æ¶ˆæ¯å­˜å‚¨ | 2-3å¤© |
| **Phase 3** | å¤šåª’ä½“æ–‡ä»¶å¤„ç†ã€OSSé›†æˆ | 2-3å¤© |
| **Phase 4** | å‰ç«¯æ¶ˆæ¯åˆ—è¡¨ã€å¤šç±»å‹æ¸²æŸ“ | 3-5å¤© |
| **Phase 5** | æ€§èƒ½ä¼˜åŒ–ã€å¼‚æ­¥å¤„ç† | 2-3å¤© |
| **Phase 6** | æµ‹è¯•ã€éƒ¨ç½² | 2-3å¤© |

**æ€»è®¡**: 14-22ä¸ªå·¥ä½œæ—¥

### 7.2 æ³¨æ„äº‹é¡¹

1. **å¼€é€šä¼šè¯å­˜æ¡£**ï¼š
   - éœ€è¦ä¼ä¸šç®¡ç†å‘˜åœ¨ä¼ä¸šå¾®ä¿¡åå°å¼€é€š
   - ç­¾ç½²ã€Šä¼šè¯å­˜æ¡£ç¡®è®¤å‡½ã€‹
   - å®¡æ ¸é€šè¿‡åæ‰èƒ½ä½¿ç”¨

2. **è´¹ç”¨**ï¼š
   - ä¼šè¯å­˜æ¡£å±äº**ä»˜è´¹æœåŠ¡**
   - æŒ‰ç…§å­˜æ¡£ç”¨æˆ·æ•°æ”¶è´¹ï¼ˆå…·ä½“ä»·æ ¼å’¨è¯¢ä¼ä¸šå¾®ä¿¡ï¼‰

3. **åˆè§„æ€§**ï¼š
   - éœ€è¦å‘˜å·¥çŸ¥æƒ…å¹¶åŒæ„
   - ä»…ç”¨äºåˆè§„ç›‘ç®¡ï¼Œä¸å¾—æ»¥ç”¨
   - æ•æ„Ÿä¿¡æ¯éœ€è¦è„±æ•å¤„ç†

4. **æ€§èƒ½**ï¼š
   - å®šæ—¶ä»»åŠ¡æ‹‰å–å¢é‡æ¶ˆæ¯ï¼Œé¿å…å®æ—¶æ‹‰å–
   - å¤§æ–‡ä»¶å¼‚æ­¥ä¸‹è½½ï¼Œä¸é˜»å¡ä¸»æµç¨‹
   - ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®

5. **å®‰å…¨**ï¼š
   - ç§é’¥å¦¥å–„ä¿ç®¡ï¼Œä¸å¾—æ³„éœ²
   - API SecretåŠ å¯†å­˜å‚¨
   - æ•°æ®åº“æ•æ„Ÿå­—æ®µåŠ å¯†

### 7.3 æœ€ä½³å®è·µ

1. **æ¶ˆæ¯å»é‡**ï¼š
   - ä½¿ç”¨`msgid`ä½œä¸ºå”¯ä¸€æ ‡è¯†
   - æ•°æ®åº“æ·»åŠ å”¯ä¸€ç´¢å¼•é¿å…é‡å¤æ’å…¥

2. **æ–­ç‚¹ç»­ä¼ **ï¼š
   - ä¿å­˜æœ€åæ‹‰å–çš„`seq`
   - ä¸‹æ¬¡ä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­

3. **ç›‘æ§å‘Šè­¦**ï¼š
   - ç›‘æ§åŒæ­¥ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
   - å¤±è´¥æ—¶å‘é€å‘Šè­¦é€šçŸ¥

4. **æ—¥å¿—è®°å½•**ï¼š
   - è®°å½•æ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°é‡
   - è®°å½•è§£å¯†å¤±è´¥çš„æ¶ˆæ¯
   - è®°å½•APIè°ƒç”¨è€—æ—¶

---

## ğŸ¯ æ€»ç»“

### å…³é”®ç»“è®º

1. **WxJavaæ”¯æŒå®Œå–„**ï¼š
   - 4.2.6+ç‰ˆæœ¬å·²æ”¯æŒä¼ä¸šå¾®ä¿¡ä¼šè¯å­˜æ¡£
   - ç¤¾åŒºæ´»è·ƒï¼Œé—®é¢˜å“åº”åŠæ—¶

2. **å®ç°è·¯å¾„æ¸…æ™°**ï¼š
   - åç«¯ï¼šFinance SDK â†’ æ‹‰å–æ¶ˆæ¯ â†’ è§£å¯† â†’ å­˜å‚¨ â†’ æä¾›API
   - å‰ç«¯ï¼šè°ƒç”¨API â†’ æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨ â†’ æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹

3. **æŠ€æœ¯éš¾ç‚¹å¯æ§**ï¼š
   - åŸç”Ÿåº“ä¾èµ–ï¼šåŠ¨æ€åŠ è½½è§£å†³
   - åŠ å¯†è§£å¯†ï¼šå¤šç‰ˆæœ¬ç§é’¥ç®¡ç†
   - æ€§èƒ½é—®é¢˜ï¼šåˆ†é¡µã€å¼‚æ­¥ã€å®šæ—¶ä»»åŠ¡
   - æ–‡ä»¶å¤„ç†ï¼šOSSå­˜å‚¨ + CDNåŠ é€Ÿ

4. **å¼€æºèµ„æºä¸°å¯Œ**ï¼š
   - WeworkChatSDKæä¾›å‚è€ƒå®ç°
   - ç¤¾åŒºæœ‰å¤§é‡å®è·µæ¡ˆä¾‹
   - å‰ç«¯UIç»„ä»¶æˆç†Ÿå¯ç”¨

### é£é™©æç¤º

- âš ï¸ **ä»˜è´¹æœåŠ¡**ï¼šéœ€è¦ä¼ä¸šå¼€é€šå¹¶æ”¯ä»˜è´¹ç”¨
- âš ï¸ **åˆè§„è¦æ±‚**ï¼šéœ€è¦å‘˜å·¥çŸ¥æƒ…åŒæ„
- âš ï¸ **æ€§èƒ½å‹åŠ›**ï¼šæµ·é‡æ•°æ®éœ€è¦ä¼˜åŒ–å­˜å‚¨å’ŒæŸ¥è¯¢
- âš ï¸ **ä¾èµ–ä¼ä¸šå¾®ä¿¡**ï¼šAPIå˜æ›´å¯èƒ½éœ€è¦åŠæ—¶é€‚é…

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… è”ç³»ä¼ä¸šå¾®ä¿¡å®¢æœå¼€é€šä¼šè¯å­˜æ¡£æœåŠ¡
2. âœ… ç”Ÿæˆå…¬ç§é’¥å¯¹å¹¶åœ¨åå°é…ç½®
3. âœ… æ­å»ºå¼€å‘ç¯å¢ƒå¹¶æµ‹è¯•Finance SDK
4. âœ… æŒ‰ç…§æœ¬æŠ¥å‘Šå®ç°åç«¯å’Œå‰ç«¯åŠŸèƒ½
5. âœ… è¿›è¡Œå……åˆ†æµ‹è¯•åä¸Šçº¿ä½¿ç”¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-10-04
**ä½œè€…**: wangxiao
**ä¼ä¸š**: å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€
