# SmartAdmin èœå•å¼€å‘å·¥ä½œæµç¨‹

> **ä½œè€…**: wangxiao
> **ä¼ä¸š**: å­åˆçº¿é«˜ç§‘æ™ºèƒ½ç§‘æŠ€
> **æ›´æ–°**: 2025-10-07

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **å¼€é—­åŸåˆ™**: ä¸»è„šæœ¬ä¸ä¿®æ”¹ï¼Œç”¨å¢é‡è„šæœ¬æ‰©å±•
2. **å…¨é‡é‡å»º**: æ”¹äº†ä»»ä½•SQLå¿…é¡»å…¨éƒ¨é‡æ–°æ‰§è¡ŒéªŒè¯

---

## ğŸ“‹ èœå•IDåˆ†é…è§„åˆ™

### IDæ®µè§„åˆ’

| IDæ®µ | ç”¨é€” | ç¤ºä¾‹æ¨¡å— | å¤‡æ³¨ |
|------|------|----------|------|
| 1-99 | ç³»ç»ŸåŠŸèƒ½ | ç™»å½•ã€èœå•ã€è§’è‰² | æ ¸å¿ƒç³»ç»Ÿ |
| 100-199 | ç›‘æ§æœåŠ¡ | æ—¥å¿—ã€ç›‘æ§ã€å®šæ—¶ä»»åŠ¡ | è¿ç»´ç›¸å…³ |
| 200-299 | ä¸šåŠ¡åŠŸèƒ½ | OAã€ERPã€CRM | æ ¸å¿ƒä¸šåŠ¡ |
| 300-399 | æ”¯æ’‘åŠŸèƒ½ | æ–‡ä»¶ã€é…ç½®ã€é€šçŸ¥ | è¾…åŠ©åŠŸèƒ½ |
| **400-499** | **åŸå‹åŠŸèƒ½** â­ | å­¦å‘˜è·Ÿè¿›ã€ä¼å¾®åŠ©æ‰‹ | **åŸå‹ä¸“ç”¨** |

### åŸå‹åŠŸèƒ½IDè¯¦ç»†åˆ†é…

```
400-499: åŸå‹åŠŸèƒ½ä¸“ç”¨
â”œâ”€â”€ 400: é¡µé¢åŸå‹ï¼ˆä¸€çº§ç›®å½•ï¼‰
â”œâ”€â”€ 401-412: å­¦å‘˜è·Ÿè¿›ï¼ˆå·²å ç”¨ï¼‰
â”œâ”€â”€ 413-429: é¢„ç•™
â”œâ”€â”€ 430-439: ä¼å¾®åŠ©æ‰‹ï¼ˆå·²å ç”¨ï¼‰
â””â”€â”€ 440-499: å…¶ä»–åŸå‹åŠŸèƒ½
```

### åˆ†é…åŸåˆ™

1. âœ… æ¯ä¸ªå­åŠŸèƒ½é¢„ç•™20ä¸ªIDï¼ˆä¾‹å¦‚ï¼š430-439ï¼‰
2. âœ… æ£€æŸ¥å·²å ç”¨IDé¿å…å†²çª
3. âœ… åŒä¸€æ¨¡å—çš„èœå•IDå¿…é¡»è¿ç»­
4. âœ… ä¸è¦è·¨æ®µä½¿ç”¨ID

---

## ğŸš€ å¼€å‘æµç¨‹

### Step 0: åˆ›å»ºå‰æ£€æŸ¥ âš ï¸ å¿…è¯»

**æ£€æŸ¥ç°æœ‰èœå•**:
```bash
# æ£€æŸ¥èœå•æ˜¯å¦å·²å­˜åœ¨
docker exec -it smart-admin-mysql mysql -uroot -pSmartAdmin666 smart_admin_v3 -e "
SELECT menu_id, menu_name, parent_id FROM t_menu
WHERE menu_id BETWEEN 400 AND 499 OR menu_name LIKE '%åŸå‹%'
ORDER BY menu_id;
"
```

**æ£€æŸ¥ç»“æœå¤„ç†**:
- âœ… å·²å­˜åœ¨åŒåŠŸèƒ½çˆ¶èœå• â†’ ä½¿ç”¨ç°æœ‰èœå•çš„ `menu_id` ä½œä¸º `parent_id`
- âŒ ä¸å­˜åœ¨ â†’ å¯ä»¥åˆ›å»ºæ–°çš„çˆ¶çº§èœå•

### Step 1: åˆ›å»ºå¢é‡è„šæœ¬

**å‘½å**: `v[ç‰ˆæœ¬å·]-[åŠŸèƒ½æè¿°].sql`

**æ ‡å‡†æ¨¡æ¿**:
```sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ==========================================
-- åŠŸèƒ½æè¿°
-- ä½œè€…: wangxiao
-- æ—¥æœŸ: 2025-10-07
-- ==========================================

-- æ’å…¥èœå•ï¼ˆç¡®ä¿parent_idå­˜åœ¨ï¼‰
INSERT INTO t_menu VALUES (430, 'ä¼å¾®åŠ©æ‰‹', 1, 400, ...);
INSERT INTO t_menu VALUES (431, 'èŠå¤©è®°å½•', 2, 430, ...);

-- è§’è‰²æˆæƒï¼ˆrole_id=1ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼‰
INSERT INTO t_role_menu (role_id, menu_id) VALUES (1, 430), (1, 431);

-- éªŒè¯SQL
SELECT menu_id, menu_name, parent_id FROM t_menu WHERE menu_id >= 430;

SET FOREIGN_KEY_CHECKS = 1;
```

### Step 2: å…¨é‡é‡å»ºæ•°æ®åº“

**æ‰§è¡Œå‘½ä»¤**:
```bash
# 1. æ‰§è¡Œä¸»è„šæœ¬ï¼ˆè‡ªå¸¦DROP TABLEï¼Œä¼šæ¸…ç©ºé‡å»ºï¼‰
docker exec -i smart-admin-mysql mysql -uroot -pSmartAdmin666 smart_admin_v3 \
  < æ•°æ®åº“SQLè„šæœ¬/mysql/smart_admin_v3.sql

# 2. æŒ‰ç‰ˆæœ¬é¡ºåºæ‰§è¡Œæ‰€æœ‰å¢é‡è„šæœ¬
cd æ•°æ®åº“SQLè„šæœ¬/mysql/sql-update-log
for f in v*.sql; do
  echo "æ‰§è¡Œ: $f"
  docker exec -i smart-admin-mysql mysql -uroot -pSmartAdmin666 smart_admin_v3 < $f
done

# 3. éªŒè¯ç»“æœ
docker exec -it smart-admin-mysql mysql -uroot -pSmartAdmin666 smart_admin_v3 -e "
SELECT COUNT(*) as total_menus FROM t_menu;
SELECT menu_id, menu_name FROM t_menu WHERE menu_id BETWEEN 400 AND 499;
"
```

### Step 3: å‰ç«¯è·¯ç”±é›†æˆ

**è·¯ç”±é…ç½®**: `src/router/prototype/[æ¨¡å—].ts`

```typescript
export const prototypeRouters = [
  {
    path: '/prototype/wecom',
    component: () => import('/@/layout/index.vue'),
    meta: { title: 'ä¼å¾®åŠ©æ‰‹' },
    children: [
      {
        path: '/prototype/wecom/chat-record/list',
        component: () => import('/@/views/prototype/wecom/chat-record-list.vue'),
        meta: { title: 'èŠå¤©è®°å½•', keepAlive: true },
      },
    ],
  },
];
```

**é›†æˆä¸»è·¯ç”±**: `src/router/routers.ts`
```typescript
import { prototypeRouters } from './prototype/wecom';
export const routerArray = [...prototypeRouters, ...å…¶ä»–è·¯ç”±];
```

---

## ğŸ—„ï¸ èœå•è¡¨æ ¸å¿ƒå­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|------|--------|
| `menu_id` | bigint | èœå•ID | 430 |
| `menu_name` | varchar | èœå•åç§° | 'ä¼å¾®åŠ©æ‰‹' |
| `menu_type` | int | ç±»å‹ | 1=ç›®å½•, 2=èœå•, 3=åŠŸèƒ½ç‚¹ |
| `parent_id` | bigint | çˆ¶èœå•ID | 0=æ ¹èœå•, 400=é¡µé¢åŸå‹ |
| `path` | varchar | å‰ç«¯è·¯ç”± | '/prototype/wecom' |
| `component` | varchar | Vueç»„ä»¶è·¯å¾„ | '/prototype/wecom/chat-record-list.vue' |
| `api_perms` | varchar | æƒé™æ ‡è¯† | 'wecom:chat:query' |
| `visible_flag` | tinyint | æ˜¯å¦æ˜¾ç¤º | 1=æ˜¾ç¤º, 0=éšè— |
| `cache_flag` | tinyint | æ˜¯å¦ç¼“å­˜ | 1=ç¼“å­˜, 0=ä¸ç¼“å­˜ |

---

## âš ï¸ å¸¸è§é”™è¯¯ä¸è§£å†³

### é”™è¯¯1: é‡å¤åˆ›å»ºçˆ¶çº§èœå•

âŒ **é”™è¯¯åšæ³•**:
```sql
-- æ²¡æ£€æŸ¥å°±åˆ›å»ºï¼Œå¯¼è‡´é‡å¤
INSERT INTO t_menu VALUES (500, 'é¡µé¢åŸå‹', 1, 0, ...);
-- å®é™…ä¸Š menu_id=400 å·²ç»å­˜åœ¨"é¡µé¢åŸå‹"ï¼
```

âœ… **æ­£ç¡®åšæ³•**:
```sql
-- 1. å…ˆæŸ¥è¯¢
SELECT menu_id FROM t_menu WHERE menu_name = 'é¡µé¢åŸå‹';
-- ç»“æœï¼šmenu_id = 400 å·²å­˜åœ¨

-- 2. ä½¿ç”¨ç°æœ‰çˆ¶çº§
INSERT INTO t_menu VALUES (430, 'ä¼å¾®åŠ©æ‰‹', 1, 400, ...);  -- parent_id=400
```

### é”™è¯¯2: IDæ®µåˆ†é…é”™è¯¯

âŒ **é”™è¯¯**: åŸå‹åŠŸèƒ½ä½¿ç”¨500+çš„ID
âœ… **æ­£ç¡®**: åŸå‹åŠŸèƒ½å¿…é¡»ä½¿ç”¨ 400-499

### é”™è¯¯3: parentIdæŒ‡å‘ä¸å­˜åœ¨çš„èœå•

âŒ **é”™è¯¯**: `INSERT INTO t_menu VALUES (431, 'èŠå¤©è®°å½•', 2, 500, ...);`
âœ… **æ­£ç¡®**: å…ˆç¡®ä¿ parent_id=430 å­˜åœ¨

---

## ğŸ” æ•…éšœæ’æŸ¥

### èœå•ä¸æ˜¾ç¤ºï¼Ÿ

1. æ£€æŸ¥ `t_role_menu` æ˜¯å¦æˆæƒ
2. æ£€æŸ¥ `visible_flag` æ˜¯å¦ä¸º 1
3. æ£€æŸ¥å‰ç«¯ `routers.ts` æ˜¯å¦æ³¨å†Œè·¯ç”±

### æ¥å£æŠ¥"æ— æƒé™"ï¼Ÿ

1. æ£€æŸ¥ `@SaCheckPermission` å’Œæ•°æ®åº“ `api_perms` æ˜¯å¦ä¸€è‡´
2. å¼€å‘ç¯å¢ƒæ£€æŸ¥Mockç”¨æˆ· `administratorFlag = true`

### Duplicate entryé”™è¯¯ï¼Ÿ

- ä¸»è„šæœ¬è‡ªå¸¦DROP TABLEï¼Œç›´æ¥é‡æ–°æ‰§è¡Œä¸»è„šæœ¬å³å¯

---

## ğŸ“ å¼€å‘æ£€æŸ¥æ¸…å•

### åˆ›å»ºèœå•å‰
- [ ] æŸ¥è¯¢ç°æœ‰èœå•ï¼Œé¿å…é‡å¤åˆ›å»ºçˆ¶çº§
- [ ] ç¡®è®¤IDæ®µåˆ†é…ï¼ˆ400-499åŸå‹åŠŸèƒ½ï¼‰
- [ ] æ£€æŸ¥å·²å ç”¨IDï¼Œé¿å…å†²çª

### åˆ›å»ºè„šæœ¬æ—¶
- [ ] å‘½åè§„èŒƒï¼š`v[ç‰ˆæœ¬]-[åŠŸèƒ½].sql`
- [ ] parent_id ç¡®ä¿çˆ¶èœå•å­˜åœ¨
- [ ] menu_id è¿ç»­ä¸”åœ¨æ­£ç¡®IDæ®µå†…
- [ ] åŒ…å«è§’è‰²æˆæƒSQL
- [ ] åŒ…å«éªŒè¯SQL

### æ‰§è¡Œå
- [ ] å…¨é‡é‡å»ºæ•°æ®åº“ï¼ˆä¸»è„šæœ¬ + æ‰€æœ‰å¢é‡ï¼‰
- [ ] éªŒè¯èœå•æ’å…¥æˆåŠŸ
- [ ] å‰ç«¯è·¯ç”±é…ç½®æ­£ç¡®
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## ğŸ“– å‚è€ƒèµ„æº

- æ•°æ®åº“ä¸»è„šæœ¬: `æ•°æ®åº“SQLè„šæœ¬/mysql/smart_admin_v3.sql`
- å¢é‡è„šæœ¬ç›®å½•: `æ•°æ®åº“SQLè„šæœ¬/mysql/sql-update-log/`
- å‰ç«¯è·¯ç”±ç›®å½•: `smart-admin-web-typescript/src/router/`

---

**æœ€ä½³å®è·µ**: å…ˆæ£€æŸ¥ã€å†è§„åˆ’ã€åæ‰§è¡Œï¼Œå…¨é‡éªŒè¯ã€‚æ¯æ¬¡ä¿®æ”¹SQLéƒ½è¦é‡å»ºæ•´ä¸ªæ•°æ®åº“ç¡®ä¿ä¸€è‡´æ€§ã€‚